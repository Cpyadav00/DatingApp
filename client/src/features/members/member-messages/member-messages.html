<div class="flex flex-col w-full h-[72vh] max-h-screen">
    <!-- Messages Container -->
    <div class="flex flex-col flex-grow overflow-auto px-2 sm:px-4">
        @for (message of messageService.messageThread(); track message.id) {
        <div class="chat"
             [class.chat-start]="!message.currentUserSender"
             [class.chat-end]="message.currentUserSender">

            <!-- Avatar -->
            <div class="chat-image avatar"
                 [class.avatar-online]="presenceService.onlineUsers().includes(message.senderId || message.recipientId)">
                <div class="w-8 sm:w-10 rounded-full">
                    <img alt="image of user"
                         class="object-cover"
                         [src]="message.senderImageUrl || '/user.png'" />
                </div>
            </div>

            <!-- Header -->
            <div class="chat-header flex flex-wrap items-center gap-1 text-xs sm:text-sm">
                <span class="font-semibold">{{message.senderDisplayName}}</span>
                <time class="opacity-50">{{message.messageSent | date:'short'}}</time>
            </div>

            <!-- Message bubble -->
            <div class="chat-bubble break-words max-w-[80%] sm:max-w-[60%]">
                {{message.content}}
            </div>

            <!-- Footer -->
            @if (message.currentUserSender && message.dateRead) {
            <div class="chat-footer text-[10px] sm:text-xs opacity-50">
                Seen {{message.dateRead | timeAgo}}
            </div>
            } @else if (message.currentUserSender && !message.dateRead) {
            <div class="chat-footer text-[10px] sm:text-xs opacity-50">
                Not read
            </div>
            } @else {
            <div class="chat-footer text-[10px] sm:text-xs opacity-50">
                Delivered
            </div>
            }
        </div>
        }

        <!-- Scroll to bottom reference -->
        <div #messageEndRef></div>
    </div>

    <!-- Message Input -->
    <div class="flex flex-col sm:flex-row gap-2 p-2 border-t border-gray-200">
        <input [(ngModel)]="messageContent"
               class="input input-bordered w-full text-sm sm:text-base"
               placeholder="Enter your message"
               (keydown.enter)="sendMessage()" />
        <button (click)="sendMessage()"
                type="submit"
                class="btn btn-primary w-full sm:w-auto">
            Send
        </button>
    </div>
</div>
